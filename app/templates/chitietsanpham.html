{% extends 'layout/base.html' %}

{% block title %}{{ sach.tensach }}{% endblock %}

{% block content %}

<div class="row mt-4 justify-content-between">
    <div class="col-md-3 col-sm-12 ms-4">
        <img src="{{ sach.anhbia }}" alt="anhbia" style="width: 100%; height: 410px;">
    </div>
    <div class="col-md-8 col-sm-12">
        <h1 class="text-center m-2">{{ sach.tensach }}</h1>
        <p>0 đánh giá | Đã bán: 3</p>
        <hr>
        <h3 class="text-danger">{{ "{:,.0f}".format(sach.gia) }} VNĐ</h3>
        <hr>
        <div class="row">
            <ul class="col-md-5 col-sm-12 ms-3">
                <li>Mã sách: {{ sach.id }}</li>
                <li>Tác giả: {{ tacgia.tentacgia }}</li>
                <li>Thể loại: {% for t in theLoai %}{{ t.tentheloai }} {% endfor %}</li>
                <li>Nhà xuất bản: {{ nhaxuatban.tennhaxuatban }}</li>
                <li>Kho còn lại: {{ sach.soluongtonkho }}</li>
            </ul>

            <div class="col-md-6 col-sm-12">
                {% if sach.soluongtonkho != 0 %}
                <h3>Số lượng</h3>
                <input type="number" min="1" max="{{ sach.soluongtonkho }}" value="1" class="text-center d-block mb-3"
                       id="soluong">
                <button class="btn bg-danger text-white rounded-2 d-block w-100 mb-2"
                        onclick="addToCart('{{sach['id']}}', '{{sach['tensach']}}', {{sach['gia']}},{% if current_user.is_authenticated and current_user.user_role|string == 'LoaiTaiKhoan.KHACHHANG' %}{{ current_user.id }}{% else %}''{% endif %}, {{sach['soluongtonkho']}}, 0)">
                    THÊM VÀO GIỎ HÀNG
                </button>
                <button class="btn bg-danger text-white rounded-2 d-block w-50"
                        onclick="addToCart('{{sach['id']}}', '{{sach['tensach']}}', {{sach['gia']}},{% if current_user.is_authenticated and current_user.user_role|string == 'LoaiTaiKhoan.KHACHHANG' %}{{ current_user.id }}{% else %}''{% endif %}, {{sach['soluongtonkho']}}, 0, 'True')">
                    MUA NGAY
                </button>
                {% else %}
                <button class="btn bg-danger text-white rounded-2 d-block w-100">TẠM HẾT HÀNG</button>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row ms-md-4 mt-4">
        <hr class="mb-2">
        <h3>Mô tả - đánh giá</h3>
        <p>{{ sach.mota }}</p>
        <hr class="mt-2">
    </div>
    <div class="row ms-md-4 mt-4">
        <h3>Bình luận</h3>
        <div>
            <textarea class="w-100 p-2" style="resize: none;" rows="5"
                      placeholder="Viết nội dung đánh giá của bạn" name="binhluan" id="binhluan"></textarea>
            <div class="text-end">
                <button
                        class="btn btn-primary"
                        onclick="addReview('{{ sach['id'] }}', {% if current_user.is_authenticated and current_user.user_role|string == 'LoaiTaiKhoan.KHACHHANG' %}{{ current_user.id }}{% else %}''{% endif %})">Đánh giá</button>
            </div>
        </div>
        <hr class="mt-2">
    </div>

    {% for b in binhluan.values() %}
    <div class="comment ms-md-4 row">
        <h3>{{ b['tenkhachhang'] }}</h3>
        <p>{{ b['ngaybinhluan'] }}</p>
        <p>{{ b['noidung'] }}</p>
        <hr>
    </div>
    {% endfor %}
</div>
{% endblock %}